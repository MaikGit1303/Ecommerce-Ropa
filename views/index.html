<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>
   Shopping App
  </title>
  <script src="https://cdn.tailwindcss.com">
  </script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="../css/style.css"/> <!-- Enlace al archivo CSS externo -->
 </head>
 <body class="bg-gray-100 text-gray-900">
  <!-- Header -->
  <div class="p-4 bg-white shadow-md">
    <div class="flex items-center justify-between mb-4">
      <div>
        <p class="text-sm text-gray-500">Hello, Welcome ðŸ‘‹</p>
        <p id="userNameDisplay" class="font-semibold text-gray-900 text-lg">Albert Stevano</p>
      </div>
      <label for="profileImageInput" class="cursor-pointer">
        <img id="profileImage" alt="User avatar" class="w-10 h-10 rounded-full" src="../storage/img/icons.jpg" />
        <input id="profileImageInput" type="file" accept="image/*" class="hidden" onchange="changeProfileImage(event)" />
      </label>
    </div>
    <div class="flex items-center space-x-2">
      <div class="flex items-center bg-gray-100 p-2 rounded-md flex-grow">
        <i class="fas fa-search text-gray-500"></i>
        <input id="search-input" class="bg-transparent outline-none ml-2 w-full" placeholder="Search clothesâ€¦" type="text" oninput="searchProducts()" />
      </div>
      <button class="p-2 text-white rounded-md relative" onclick="toggleFilterMenu()">
        <img src="../storage/img/filter.jpg" alt="Filter" class="w-15 h-15" />
      </button>
      <!-- Filter Dropdown -->
      <div id="filterMenu" class="hidden absolute top-16 right-4 bg-white shadow-md rounded-lg w-48">
        <ul class="text-gray-700">
          <li class="p-2 hover:bg-gray-100 cursor-pointer" onclick="applyFilter('price')">Filtrar por precio</li>
          <li class="p-2 hover:bg-gray-100 cursor-pointer" onclick="applyFilter('rating')">Filtrar por calificaciÃ³n</li>
          <li class="p-2 hover:bg-gray-100 cursor-pointer" onclick="applyFilter('popularity')">Filtrar por popularidad</li>
        </ul>
      </div>
    </div>
  </div>
  <!-- Categories -->
  <div class="p-4">
    <div class="categories-container">
      <button class="category-btn active" onclick="filterCategory('all')">
        <img src="../storage/img/Default Icon.png" alt="All Items" />
        <span>All Items</span>
      </button>
      <button class="category-btn" onclick="filterCategory('dress')">
        <img src="../storage/img/Default Icon (2).png" alt="Dress" />
        <span>Dress</span>
      </button>
      <button class="category-btn" onclick="filterCategory('tshirt')">
        <img src="../storage/img/Default Icon (3).png" alt="T-Shirt" />
        <span>T-Shirt</span>
      </button>
      <button class="category-btn" onclick="filterCategory('jeans')">
        <img src="../storage/img/Default Icon (4).png" alt="Jeans" />
        <span>Jeans</span>
      </button>
    </div>
  </div>
  <!-- Product List -->
  <div id="product-list" class="p-4 grid grid-cols-2 gap-4">
   <div class="bg-white p-4 rounded-lg shadow-md relative" data-name="T-Shirt Modern Light Clothes" data-price="212.99" data-image="../storage/img/product 1.png" data-popularity="150" onclick="viewProduct(this)">
    <img alt="Modern Light Clothes" class="w-full h-40 object-cover rounded-md mb-2" src="../storage/img/product 1.png"/>
    <p class="font-semibold text-black">
     Modern Light Clothes
    </p>
    <p class="text-gray-500">
     T-Shirt
    </p>
    <div class="flex items-center justify-between mt-1">
      <p class="font-bold text-black">
        $212.99
      </p>
      <div class="flex items-center text-yellow-400 text-sm">
        <i class="fas fa-star"></i>
        <span class="ml-1">4.5</span>
      </div>
    </div>
    <button class="like-btn" onclick="toggleFavorite(event, this)">
     <i class="far fa-heart"></i>
    </button>
   </div>
   <div class="bg-white p-4 rounded-lg shadow-md relative" data-name="Light Dress Bless" data-price="162.99" data-image="../storage/img/product 2.png" data-popularity="200" onclick="viewProduct(this)">
    <img alt="Light Dress Bless" class="w-full h-40 object-cover rounded-md mb-2" src="../storage/img/product 2.png"/>
    <p class="font-semibold">
     Light Dress Bless
    </p>
    <p class="text-gray-500">
     Dress modern
    </p>
    <div class="flex items-center justify-between mt-1">
      <p class="font-bold">
        $162.99
      </p>
      <div class="flex items-center text-yellow-400 text-sm">
        <i class="fas fa-star"></i>
        <span class="ml-1">4.0</span>
      </div>
    </div>
    <button class="like-btn" onclick="toggleFavorite(event, this)">
     <i class="far fa-heart"></i>
    </button>
   </div>
   <div class="bg-white p-4 rounded-lg shadow-md relative" data-name="Classic Blue Jeans" data-price="89.99" data-image="../storage/img/product 3.png" data-popularity="120" onclick="viewProduct(this)">
    <img alt="Classic Blue Jeans" class="w-full h-40 object-cover rounded-md mb-2" src="../storage/img/product 3.png"/>
    <p class="font-semibold">
     Classic Blue Jeans
    </p>
    <p class="text-gray-500">
     Jeans
    </p>
    <div class="flex items-center justify-between mt-1">
      <p class="font-bold">
        $89.99
      </p>
      <div class="flex items-center text-yellow-400 text-sm">
        <i class="fas fa-star"></i>
        <span class="ml-1">3.8</span>
      </div>
    </div>
    <button class="like-btn" onclick="toggleFavorite(event, this)">
     <i class="far fa-heart"></i>
    </button>
   </div>
   <div class="bg-white p-4 rounded-lg shadow-md relative" data-name="Slim Fit Jeans" data-price="99.99" data-image="../storage/img/product 4.png" data-popularity="180" onclick="viewProduct(this)">
    <img alt="Slim Fit Jeans" class="w-full h-40 object-cover rounded-md mb-2" src="../storage/img/product 4.png"/>
    <p class="font-semibold">
     Slim Fit Jeans
    </p>
    <p class="text-gray-500">
     Jeans
    </p>
    <div class="flex items-center justify-between mt-1">
      <p class="font-bold">
        $99.99
      </p>
      <div class="flex items-center text-yellow-400 text-sm">
        <i class="fas fa-star"></i>
        <span class="ml-1">4.7</span>
      </div>
    </div>
    <button class="like-btn" onclick="toggleFavorite(event, this)">
     <i class="far fa-heart"></i>
    </button>
   </div>
  </div>
  <!-- Bottom Navigation -->
  <div class="bottom-nav">
    <button class="active" onclick="navigateTo('home')">
      <img src="../storage/img/Main Icon.png" alt="Home" />
    </button>
    <button id="cart-button" onclick="navigateTo('cart')" style="position: relative;">
      <img src="../storage/img/Main Icon (1).png" alt="Cart" />
      <div id="cart-notification" class="notification-dot" style="display: none;"></div>
    </button>
    <button onclick="navigateTo('favorites')">
      <img src="../storage/img/Main Icon (2).png" alt="Favorites" />
    </button>
    <button onclick="navigateTo('profile')">
      <img src="../storage/img/Main Icon (3).png" alt="Profile" />
    </button>
  </div>
  <script>
    let cartItems = JSON.parse(localStorage.getItem('cart')) || [];

    function addToCart(productElement) {
      const product = {
        name: productElement.getAttribute('data-name'),
        price: parseFloat(productElement.getAttribute('data-price')),
        imageUrl: productElement.getAttribute('data-image'),
      };

      // Agregar el producto al carrito
      cartItems.push(product);
      localStorage.setItem('cart', JSON.stringify(cartItems));

      // Mostrar notificaciÃ³n en el botÃ³n de carrito
      const cartNotification = document.getElementById('cart-notification');
      cartNotification.style.display = 'block';
      cartNotification.textContent = cartItems.length;
    }

    function filterCategory(category) {
        console.log(`Filtering category: ${category}`);
        const buttons = document.querySelectorAll('.category-btn');
        buttons.forEach(button => {
          button.classList.remove('active');
          button.style.backgroundColor = 'white'; // Fondo blanco para todos los botones
          button.style.color = 'black'; // Texto negro para todos los botones
        });

        // Buscar el botÃ³n correspondiente al texto del filtro
        const activeButton = Array.from(buttons).find(btn => {
          const buttonText = btn.querySelector('span').textContent.trim().toLowerCase();
          return buttonText === category.toLowerCase();
        });

        if (activeButton) {
          activeButton.classList.add('active'); // Agregar clase activa al botÃ³n seleccionado
          activeButton.style.backgroundColor = 'black'; // Fondo negro para el botÃ³n activo
          activeButton.style.color = 'white'; // Texto blanco para el botÃ³n activo
        }

        // LÃ³gica para filtrar productos por categorÃ­a
        const products = document.querySelectorAll('#product-list > div');
        products.forEach(product => {
          const productCategory = product.getAttribute('data-name').toLowerCase();
          if (category === 'all' || productCategory.includes(category)) {
            product.style.display = 'block';
          } else {
            product.style.display = 'none';
          }
        });
      }

      document.addEventListener('DOMContentLoaded', () => {
        const activeButton = document.querySelector('.category-btn.active');
        if (activeButton) {
          activeButton.style.backgroundColor = 'black'; // Fondo negro
          activeButton.style.color = 'white'; // Texto blanco
        }

        // Mostrar notificaciÃ³n si hay productos en el carrito
        const cartNotification = document.getElementById('cart-notification');
        if (cartItems.length > 0) {
          cartNotification.style.display = 'block';
          cartNotification.textContent = cartItems.length;
        }

        // Activar el filtro "All Items" por defecto
        filterCategory('all');
      });

    function viewProduct(productElement) {
      const product = {
        name: productElement.getAttribute('data-name'),
        price: parseFloat(productElement.getAttribute('data-price')), // Guardar el precio como nÃºmero
        imageUrl: productElement.getAttribute('data-image'),
      };
      localStorage.setItem('selectedProduct', JSON.stringify(product));
      window.location.href = 'detail.html';
    }

    function toggleFavorite(event, button) {
      event.stopPropagation();
      const icon = button.querySelector('i');
      const productElement = button.closest('div[data-name]');
      const product = {
        name: productElement.getAttribute('data-name'),
        price: parseFloat(productElement.getAttribute('data-price')),
        imageUrl: productElement.getAttribute('data-image'),
      };

      let favorites = JSON.parse(localStorage.getItem('favorites')) || [];

      if (icon.classList.contains('far')) {
        // Agregar a favoritos
        favorites.push(product);
        localStorage.setItem('favorites', JSON.stringify(favorites));
        icon.classList.remove('far');
        icon.classList.add('fas');
        console.log(`${product.name} agregado a favoritos.`);
      } else {
        // Eliminar de favoritos
        favorites = favorites.filter(item => item.name !== product.name);
        localStorage.setItem('favorites', JSON.stringify(favorites));
        icon.classList.remove('fas');
        icon.classList.add('far');
        console.log(`${product.name} eliminado de favoritos.`);
      }

      // Sincronizar el estado del corazÃ³n en todas las pÃ¡ginas
      syncFavorites();
    }

    function syncFavorites() {
      const favorites = JSON.parse(localStorage.getItem('favorites')) || [];
      const productElements = document.querySelectorAll('#product-list > div');

      productElements.forEach(productElement => {
        const productName = productElement.getAttribute('data-name');
        const likeButton = productElement.querySelector('.like-btn i');

        if (favorites.some(product => product.name === productName)) {
          likeButton.classList.remove('far');
          likeButton.classList.add('fas');
        } else {
          likeButton.classList.remove('fas');
          likeButton.classList.add('far');
        }
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      syncFavorites(); // Sincronizar el estado de los corazones al cargar la pÃ¡gina
    });

    function navigateTo(page) {
      console.log(`Navigating to: ${page}`);
      const buttons = document.querySelectorAll('.bottom-nav button');
      buttons.forEach(button => button.classList.remove('active'));

      switch (page) {
        case 'home':
          console.log('Already on Home page');
          buttons[0].classList.add('active');
          break;
        case 'cart':
          window.location.href = 'checkout.html'; // Redirigir a la pÃ¡gina de checkout
          break;
        case 'favorites':
          window.location.href = 'favorites.html'; // Redirigir a la pÃ¡gina de favoritos
          break;
        case 'profile':
          window.location.href = 'account.html'; // Redirigir a la pÃ¡gina de perfil
          break;
        default:
          console.log('Unknown page');
      }
    }

    function searchProducts() {
      const searchInput = document.getElementById('search-input').value.toLowerCase();
      const products = document.querySelectorAll('#product-list > div');
      products.forEach(product => {
        const productName = product.getAttribute('data-name').toLowerCase();
        if (productName.includes(searchInput)) {
          product.style.display = 'block';
        } else {
          product.style.display = 'none';
        }
      });
    }

    function toggleFilterMenu() {
      const filterMenu = document.getElementById('filterMenu');
      filterMenu.classList.toggle('hidden'); // Mostrar u ocultar el menÃº de filtros

      // Agregar o quitar el evento de clic fuera del menÃº
      if (!filterMenu.classList.contains('hidden')) {
        document.addEventListener('click', closeFilterMenuOnClickOutside);
      } else {
        document.removeEventListener('click', closeFilterMenuOnClickOutside);
      }
    }

    function closeFilterMenuOnClickOutside(event) {
      const filterMenu = document.getElementById('filterMenu');
      const filterButton = document.querySelector('button[onclick="toggleFilterMenu()"]');

      if (!filterMenu.contains(event.target) && !filterButton.contains(event.target)) {
        filterMenu.classList.add('hidden'); // Ocultar el menÃº
        document.removeEventListener('click', closeFilterMenuOnClickOutside); // Eliminar el evento
      }
    }

    function applyFilter(type) {
      const filterMenu = document.getElementById('filterMenu');
      filterMenu.classList.add('hidden'); // Ocultar el menÃº despuÃ©s de aplicar el filtro

      const products = Array.from(document.querySelectorAll('#product-list > div'));

      switch (type) {
        case 'price':
          products.sort((a, b) => parseFloat(a.getAttribute('data-price')) - parseFloat(b.getAttribute('data-price')));
          console.log('Filtrado por precio');
          break;
        case 'rating':
          products.sort((a, b) => {
            const ratingA = parseFloat(a.querySelector('.text-yellow-400 span').textContent);
            const ratingB = parseFloat(b.querySelector('.text-yellow-400 span').textContent);
            return ratingB - ratingA; // Ordenar de mayor a menor calificaciÃ³n
          });
          console.log('Filtrado por calificaciÃ³n');
          break;
        case 'popularity':
          products.sort((a, b) => {
            const popularityA = parseInt(a.getAttribute('data-popularity')) || 0;
            const popularityB = parseInt(b.getAttribute('data-popularity')) || 0;
            return popularityB - popularityA; // Ordenar de mayor a menor popularidad
          });
          console.log('Filtrado por popularidad');
          break;
        default:
          console.log('Filtro desconocido');
      }

      const productList = document.getElementById('product-list');
      productList.innerHTML = ''; // Limpiar la lista de productos
      products.forEach(product => productList.appendChild(product)); // Reordenar los productos
    }

    function changeProfileImage(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          document.getElementById('profileImage').src = e.target.result; // Actualizar la imagen de perfil
          localStorage.setItem('profileImage', e.target.result); // Guardar la imagen en localStorage
        };
        reader.readAsDataURL(file);
      }
    }

    function loadUserInfo() {
      const savedImage = localStorage.getItem('profileImage');
      const savedName = localStorage.getItem('userName');

      // Establecer valores por defecto si no hay datos en localStorage
      const defaultImage = "../storage/img/jholver pardo.jpeg";
      const defaultName = "Jholver Pardo";

      document.getElementById('profileImage').src = savedImage || defaultImage; // Cargar la imagen guardada o usar la predeterminada
      document.getElementById('userNameDisplay').textContent = savedName || defaultName; // Cargar el nombre guardado o usar el predeterminado
    }

    document.addEventListener('DOMContentLoaded', function () {
      loadUserInfo(); // Cargar la informaciÃ³n del usuario al inicio
    });
  </script>
 </body>
</html>
